(function(){var ImageManager=this.ImageManager={initialize:function(){o=this._getUriObject(window.self.location.href);q=new Hash(this._getQueryObject(o.query));this.editor=decodeURIComponent(q.get('e_name'));this.browse=decodeURIComponent(q.get('e_show'));this.fields=new Object();this.fields.url=document.id("f_url");this.fields.alt=document.id("f_alt");this.fields.align=document.id("f_align");this.fields.title=document.id("f_title");this.fields.caption=document.id("f_caption");this.frame=window.frames['imageframe'];this.frameurl=this.frame.location.href;this.imageframe=document.id('imageframe');this.imageframe.manager=this;this.imageframe.addEvent('load',function(){ImageManager.onloadimageview()});this.upbutton=document.id('upbutton');this.upbutton.removeEvents('click');this.upbutton.addEvent('click',function(){ImageManager.upFolder()})},onloadimageview:function(){this.frameurl=this.frame.location.href;var folder=this.getImageFolder();document.getElementById('view_current_folder').innerHTML='/'+folder;document.getElementById('current_folder_val').value=folder;a=this._getUriObject(document.id('uploadForm').getProperty('action'));q=new Hash(this._getQueryObject(a.query));q.set('folder',folder);var query=[];q.each(function(v,k){if($chk(v)){this.push(k+'='+v)}},query);a.query=query.join('&');var portString='';if(typeof(a.port)!=='undefined'&&a.port!=80){portString=':'+a.port}document.id('uploadForm').setProperty('action',a.scheme+'://'+a.domain+portString+a.path+'?'+a.query)},getImageFolder:function(){var url=this.frame.location.search.substring(1);var args=this.parseQuery(url);return args['folder']},onok:function(){extra='';var url=this.fields.url.get('value');var alt=this.fields.alt.get('value');var align=this.fields.align.get('value');var title=this.fields.title.get('value');var caption=this.fields.caption.get('value');if(url!=''){if(alt!=''){extra=extra+'alt="'+alt+'" '}else{extra=extra+'alt="" '}if(align!=''){extra=extra+'align="'+align+'" '}if(title!=''){extra=extra+'title="'+title+'" '}if(caption!=''){extra=extra+'class="caption" '}var tag="<img src=\""+url+"\" "+extra+"/>"}var editor_str=this.editor.replace(/jform/g,'');editor_str=editor_str.replace(/params/g,'');editor_str=editor_str.replace(/\[/g,'');editor_str=editor_str.replace(/\]/g,'');eval('window.parent.jInsertEditorText_'+editor_str+'(tag, this.editor);');return false},onok2:function(){var url=this.fields.url.get('value');if(this.editor&&this.editor!=null)window.parent.document.getElementById(this.editor).value=url;if(this.browse&&this.browse!=null)window.parent.document.getElementById(this.browse).src='../'+url;return false},setFolder:function(folder,asset,author){this.frame.location.href='index.php?option=com_media&view=imagesList&tmpl=component&folder='+folder+'&asset='+asset+'&author='+author},getFolder:function(){return''},upFolder:function(){var current_folder=document.getElementById('current_folder_val').value;var folders=current_folder.split('/');var folder='';var lock_folders=lock_folder.split('/');if(lock_folder!=null&&lock_folder!=''&&lock_folders.length<folders.length){for(var i=0;i<folders.length-1;i++){folder+=folders[i];folder+='/'}folder=folder.substring(0,folder.length-1);document.getElementById('view_current_folder').innerHTML='/'+folder;document.getElementById('current_folder_val').value=folder;this.setFolder(folder)}else{alert('对不起，您不能访问上级目录！')}},populateFields:function(file){document.id("f_url").value=image_base_path+file},showMessage:function(text){var message=document.id('message');var messages=document.id('messages');if(message.firstChild)message.removeChild(message.firstChild);message.appendChild(document.createTextNode(text));messages.style.display="block"},parseQuery:function(query){var params=new Object();if(!query){return params}var pairs=query.split(/[;&]/);for(var i=0;i<pairs.length;i++){var KeyVal=pairs[i].split('=');if(!KeyVal||KeyVal.length!=2){continue}var key=unescape(KeyVal[0]);var val=unescape(KeyVal[1]).replace(/\+ /g,' ');params[key]=val}return params},refreshFrame:function(){this._setFrameUrl()},_setFrameUrl:function(url){if(url!=null){this.frameurl=url}this.frame.location.href=this.frameurl},_getQueryObject:function(q){var vars=q.split(/[&;]/);var rs={};if(vars.length)vars.each(function(val){var keys=val.split('=');if(keys.length&&keys.length==2)rs[encodeURIComponent(keys[0])]=encodeURIComponent(keys[1])});return rs},_getUriObject:function(u){var bits=u.match(/^(?:([^:\/?#.]+):)?(?:\/\/)?(([^:\/?#]*)(?::(\d*))?)((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[\?#]|$)))*\/?)?([^?#\/]*))?(?:\?([^#]*))?(?:#(.*))?/);return(bits)?bits.associate(['uri','scheme','authority','domain','port','path','directory','file','query','fragment']):null}}})(document.id);window.addEvent('domready',function(){ImageManager.initialize()});